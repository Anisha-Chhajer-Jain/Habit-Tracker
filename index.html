
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker Calendar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #10b981;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --border-radius: 10px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            background-color: #f1f5f9;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 25px;
        }

        /* Header */
        .header {
            grid-column: 1 / -1;
            background-color: white;
            padding: 20px 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .header h1 {
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header h1 i {
            color: var(--secondary);
        }

        .reminder-banner {
            grid-column: 1 / -1;
            background-color: var(--primary-light);
            color: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            display: none;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Sidebar */
        .sidebar {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
            height: fit-content;
        }

        .sidebar h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gray-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .habits-list {
            list-style: none;
            margin-bottom: 30px;
        }

        .habit-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 5px solid var(--primary);
        }

        .habit-item:hover {
            background-color: var(--gray-light);
        }

        .habit-item.active {
            background-color: var(--primary-light);
            color: white;
            font-weight: bold;
        }

        .habit-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            display: inline-block;
        }

        .habit-streak {
            background-color: var(--light);
            color: var(--dark);
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .add-habit-form {
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .add-habit-form input {
            padding: 12px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 1rem;
        }

        .add-habit-form button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-habit-form button:hover {
            background-color: #0da271;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .calendar-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .calendar-header h2 {
            color: var(--primary);
            font-size: 1.8rem;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav button {
            background-color: var(--light);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
        }

        .calendar-nav button:hover {
            background-color: var(--gray-light);
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: bold;
            color: var(--gray);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-light);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid transparent;
        }

        .day:hover {
            background-color: var(--gray-light);
        }

        .day.empty {
            background-color: transparent;
            cursor: default;
        }

        .day.empty:hover {
            background-color: transparent;
        }

        .day.completed {
            border-color: var(--secondary);
        }

        .day-number {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .day-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-top: 5px;
        }

        .day-note-indicator {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 0.7rem;
            color: var(--primary);
        }

        /* Streak Panel */
        .streak-panel {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
        }

        .streak-panel h2 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .current-streak {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--secondary);
            text-align: center;
            margin-bottom: 25px;
        }

        .badges-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .badge {
            background-color: var(--light);
            padding: 10px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .badge.unlocked {
            background-color: var(--primary-light);
            color: white;
        }

        .badge.new {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Controls */
        .controls {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 10px;
        }

        .control-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-card h3 {
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reminder-control {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--secondary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        .export-import-buttons {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .export-import-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .export-btn {
            background-color: var(--primary);
            color: white;
        }

        .export-btn:hover {
            background-color: #4338ca;
        }

        .import-btn {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        .import-btn:hover {
            background-color: #d1d5db;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .modal-date {
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .modal-notes {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 1rem;
            min-height: 100px;
            resize: vertical;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .modal-save {
            background-color: var(--secondary);
            color: white;
        }

        .modal-save:hover {
            background-color: #0da271;
        }

        .modal-cancel {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        .modal-cancel:hover {
            background-color: #d1d5db;
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background-color: var(--dark);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
        }

        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--dark) transparent transparent transparent;
        }

        .day:hover .tooltip {
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .calendar-grid {
                gap: 5px;
            }
            
            .badges-container {
                justify-content: center;
            }
            
            .export-import-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1><i class="fas fa-calendar-check"></i> Habit Tracker Calendar</h1>
            <div class="current-date" id="currentDate"></div>
        </header>

        <!-- Reminder Banner -->
        <div class="reminder-banner" id="reminderBanner">
            <div>
                <i class="fas fa-bell"></i>
                <strong>Daily Reminder:</strong> Don't forget to track your habit for today!
            </div>
            <button id="dismissReminder">Dismiss</button>
        </div>

        <!-- Sidebar -->
        <aside class="sidebar">
            <h2><i class="fas fa-list"></i> My Habits</h2>
            <ul class="habits-list" id="habitsList">
                <!-- Habit items will be added here -->
            </ul>
            
            <form class="add-habit-form" id="addHabitForm">
                <input type="text" id="habitName" placeholder="New habit name" required>
                <input type="color" id="habitColor" value="#4f46e5">
                <button type="submit"><i class="fas fa-plus"></i> Add Habit</button>
            </form>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Calendar -->
            <section class="calendar-container">
                <div class="calendar-header">
                    <h2 id="calendarMonth">May 2023</h2>
                    <div class="calendar-nav">
                        <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                        <button id="todayMonth">Today</button>
                        <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                
                <div class="weekdays">
                    <div>Sun</div>
                    <div>Mon</div>
                    <div>Tue</div>
                    <div>Wed</div>
                    <div>Thu</div>
                    <div>Fri</div>
                    <div>Sat</div>
                </div>
                
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar days will be generated here -->
                </div>
            </section>
            
            <!-- Streak Panel -->
            <section class="streak-panel">
                <h2><i class="fas fa-fire"></i> Streaks & Badges</h2>
                <div class="current-streak" id="currentStreak">0 days</div>
                <div class="badges-container" id="badgesContainer">
                    <!-- Badges will be added here -->
                </div>
            </section>
        </main>

        <!-- Controls -->
        <section class="controls">
            <div class="control-card">
                <h3><i class="fas fa-bell"></i> Daily Reminder</h3>
                <div class="reminder-control">
                    <span>Enable reminders</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="reminderToggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <p>Get a daily reminder to track your habit (simulated while page is open).</p>
            </div>
            
            <div class="control-card">
                <h3><i class="fas fa-file-export"></i> Data Management</h3>
                <p>Export your habit data to a JSON file or import previously saved data.</p>
                <div class="export-import-buttons">
                    <button class="export-btn" id="exportData">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                    <button class="import-btn" id="importData">
                        <i class="fas fa-upload"></i> Import Data
                    </button>
                </div>
                <input type="file" id="importFile" accept=".json" style="display: none;">
            </div>
        </section>
    </div>

    <!-- Day Modal -->
    <div class="modal" id="dayModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Daily Entry</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-date" id="modalDate">May 15, 2023</div>
                <textarea class="modal-notes" id="modalNotes" placeholder="Add a note for today (e.g., 'Did 20 pushups', 'Drank 8 glasses of water')..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-cancel" id="cancelModal">Cancel</button>
                <button class="modal-btn modal-save" id="saveModal">Save</button>
            </div>
        </div>
    </div>

    <script>
        // Habit Tracker Application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize application
            initApp();
        });

        // Global variables
        let habits = [];
        let activeHabitId = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let selectedDay = null;
        let reminderTimeout = null;

        // Initialize the application
        function initApp() {
            // Load data from localStorage
            loadFromLocalStorage();
            
            // Set current date in header
            updateCurrentDate();
            
            // Render the sidebar with habits
            renderHabitsList();
            
            // Generate the calendar
            generateCalendar(currentMonth, currentYear);
            
            // Set up event listeners
            setupEventListeners();
            
            // Check for reminder
            checkReminder();
            
            // Initialize default habit if none exists
            if (habits.length === 0) {
                createDefaultHabits();
            }
        }

        // Load data from localStorage
        function loadFromLocalStorage() {
            const savedHabits = localStorage.getItem('habitTrackerData');
            const savedActiveHabit = localStorage.getItem('activeHabitId');
            const savedReminder = localStorage.getItem('reminderEnabled');
            
            if (savedHabits) {
                habits = JSON.parse(savedHabits);
            }
            
            if (savedActiveHabit) {
                activeHabitId = savedActiveHabit;
            }
            
            if (savedReminder) {
                document.getElementById('reminderToggle').checked = savedReminder === 'true';
            }
        }

        // Save data to localStorage
        function saveToLocalStorage() {
            localStorage.setItem('habitTrackerData', JSON.stringify(habits));
            if (activeHabitId) {
                localStorage.setItem('activeHabitId', activeHabitId);
            }
            localStorage.setItem('reminderEnabled', document.getElementById('reminderToggle').checked);
        }

        // Create default habits for first-time users
        function createDefaultHabits() {
            const defaultHabits = [
                {
                    id: 'habit1',
                    name: 'Drink Water',
                    color: '#4f46e5',
                    completedDays: {},
                    notes: {}
                },
                {
                    id: 'habit2',
                    name: 'Exercise',
                    color: '#10b981',
                    completedDays: {},
                    notes: {}
                },
                {
                    id: 'habit3',
                    name: 'Read',
                    color: '#f59e0b',
                    completedDays: {},
                    notes: {}
                }
            ];
            
            habits = defaultHabits;
            activeHabitId = 'habit1';
            saveToLocalStorage();
        }

        // Update current date in header
        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
        }

        // Render the habits list in sidebar
        function renderHabitsList() {
            const habitsList = document.getElementById('habitsList');
            habitsList.innerHTML = '';
            
            habits.forEach(habit => {
                const streak = calculateStreak(habit);
                const li = document.createElement('li');
                li.className = `habit-item ${habit.id === activeHabitId ? 'active' : ''}`;
                li.dataset.habitId = habit.id;
                li.style.borderLeftColor = habit.color;
                
                li.innerHTML = `
                    <div>
                        <span class="habit-color" style="background-color: ${habit.color}"></span>
                        ${habit.name}
                    </div>
                    <span class="habit-streak">${streak} day${streak !== 1 ? 's' : ''}</span>
                `;
                
                li.addEventListener('click', () => switchActiveHabit(habit.id));
                habitsList.appendChild(li);
            });
        }

        // Switch active habit
        function switchActiveHabit(habitId) {
            activeHabitId = habitId;
            renderHabitsList();
            generateCalendar(currentMonth, currentYear);
            updateStreakDisplay();
            saveToLocalStorage();
        }

        // Generate calendar for given month and year
        function generateCalendar(month, year) {
            const calendarGrid = document.getElementById('calendarGrid');
            const calendarMonth = document.getElementById('calendarMonth');
            
            // Update calendar month header
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            calendarMonth.textContent = `${monthNames[month]} ${year}`;
            
            // Clear previous calendar
            calendarGrid.innerHTML = '';
            
            // Get first day of month and total days in month
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Add empty cells for days before the first day of month
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'day empty';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Add cells for each day of the month
            const today = new Date();
            const isCurrentMonth = month === today.getMonth() && year === today.getFullYear();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'day';
                dayElement.dataset.day = day;
                dayElement.dataset.month = month;
                dayElement.dataset.year = year;
                
                // Check if this day is today
                if (isCurrentMonth && day === today.getDate()) {
                    dayElement.classList.add('today');
                    dayElement.style.backgroundColor = '#f0f9ff';
                }
                
                // Check if this day is completed for active habit
                const dateKey = `${year}-${month + 1}-${day}`;
                const activeHabit = habits.find(h => h.id === activeHabitId);
                
                if (activeHabit && activeHabit.completedDays[dateKey]) {
                    dayElement.classList.add('completed');
                }
                
                // Add day number
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayElement.appendChild(dayNumber);
                
                // Add status indicator
                const dayStatus = document.createElement('div');
                dayStatus.className = 'day-status';
                if (activeHabit && activeHabit.completedDays[dateKey]) {
                    dayStatus.style.backgroundColor = activeHabit.color;
                } else {
                    dayStatus.style.backgroundColor = 'transparent';
                }
                dayElement.appendChild(dayStatus);
                
                // Add note indicator if note exists
                if (activeHabit && activeHabit.notes[dateKey]) {
                    const noteIndicator = document.createElement('div');
                    noteIndicator.className = 'day-note-indicator';
                    noteIndicator.innerHTML = '<i class="fas fa-sticky-note"></i>';
                    dayElement.appendChild(noteIndicator);
                }
                
                // Add tooltip
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.textContent = `${monthNames[month]} ${day}, ${year}`;
                
                if (activeHabit && activeHabit.notes[dateKey]) {
                    tooltip.textContent += ` - ${activeHabit.notes[dateKey]}`;
                }
                
                dayElement.appendChild(tooltip);
                
                // Add click event
                dayElement.addEventListener('click', () => openDayModal(day, month, year));
                
                calendarGrid.appendChild(dayElement);
            }
        }

        // Calculate streak for a habit
        function calculateStreak(habit) {
            if (!habit || !habit.completedDays) return 0;
            
            const dates = Object.keys(habit.completedDays).sort().reverse();
            if (dates.length === 0) return 0;
            
            let streak = 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Check if today is completed
            const todayKey = `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayKey = `${yesterday.getFullYear()}-${yesterday.getMonth() + 1}-${yesterday.getDate()}`;
            
            // If today is completed, start counting from today
            let currentDate = habit.completedDays[todayKey] ? today : yesterday;
            let currentKey = habit.completedDays[todayKey] ? todayKey : yesterdayKey;
            
            while (habit.completedDays[currentKey]) {
                streak++;
                
                // Move to previous day
                currentDate.setDate(currentDate.getDate() - 1);
                currentKey = `${currentDate.getFullYear()}-${currentDate.getMonth() + 1}-${currentDate.getDate()}`;
            }
            
            return streak;
        }

        // Update streak display
        function updateStreakDisplay() {
            const activeHabit = habits.find(h => h.id === activeHabitId);
            const streak = calculateStreak(activeHabit);
            
            // Update current streak
            document.getElementById('currentStreak').textContent = `${streak} day${streak !== 1 ? 's' : ''}`;
            
            // Update badges
            const badgesContainer = document.getElementById('badgesContainer');
            badgesContainer.innerHTML = '';
            
            const badgeMilestones = [3, 7, 14, 30, 60, 90];
            
            badgeMilestones.forEach(milestone => {
                const badge = document.createElement('div');
                badge.className = `badge ${streak >= milestone ? 'unlocked' : ''}`;
                
                if (streak === milestone) {
                    badge.classList.add('new');
                }
                
                badge.innerHTML = `
                    <i class="fas ${streak >= milestone ? 'fa-trophy' : 'fa-lock'}"></i>
                    ${milestone}-day streak
                `;
                
                badgesContainer.appendChild(badge);
            });
        }

        // Open day modal
        function openDayModal(day, month, year) {
            selectedDay = { day, month, year };
            
            const date = new Date(year, month, day);
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('modalDate').textContent = `${monthNames[month]} ${day}, ${year}`;
            
            // Load existing note if available
            const dateKey = `${year}-${month + 1}-${day}`;
            const activeHabit = habits.find(h => h.id === activeHabitId);
            const existingNote = activeHabit && activeHabit.notes[dateKey] ? activeHabit.notes[dateKey] : '';
            
            document.getElementById('modalNotes').value = existingNote;
            
            // Show modal
            document.getElementById('dayModal').style.display = 'flex';
        }

        // Close day modal
        function closeDayModal() {
            document.getElementById('dayModal').style.display = 'none';
            selectedDay = null;
        }

        // Save day entry
        function saveDayEntry() {
            if (!selectedDay) return;
            
            const { day, month, year } = selectedDay;
            const dateKey = `${year}-${month + 1}-${day}`;
            const note = document.getElementById('modalNotes').value.trim();
            const activeHabit = habits.find(h => h.id === activeHabitId);
            
            if (activeHabit) {
                // Toggle completion if note is being added/updated
                if (note || !activeHabit.notes[dateKey]) {
                    activeHabit.completedDays[dateKey] = true;
                }
                
                // Save note
                if (note) {
                    activeHabit.notes[dateKey] = note;
                } else {
                    delete activeHabit.notes[dateKey];
                }
                
                // Update UI and save
                generateCalendar(currentMonth, currentYear);
                updateStreakDisplay();
                renderHabitsList();
                saveToLocalStorage();
            }
            
            closeDayModal();
        }

        // Add new habit
        function addNewHabit() {
            const habitName = document.getElementById('habitName').value.trim();
            const habitColor = document.getElementById('habitColor').value;
            
            if (!habitName) return;
            
            const newHabit = {
                id: 'habit_' + Date.now(),
                name: habitName,
                color: habitColor,
                completedDays: {},
                notes: {}
            };
            
            habits.push(newHabit);
            
            // Clear form
            document.getElementById('habitName').value = '';
            document.getElementById('habitColor').value = '#4f46e5';
            
            // Switch to new habit
            switchActiveHabit(newHabit.id);
        }

        // Check and show reminder
        function checkReminder() {
            const reminderEnabled = document.getElementById('reminderToggle').checked;
            
            if (reminderEnabled) {
                // For demonstration, show reminder after 2 seconds
                // In a real app, this would check the current time
                reminderTimeout = setTimeout(() => {
                    document.getElementById('reminderBanner').style.display = 'flex';
                }, 2000);
            } else {
                clearTimeout(reminderTimeout);
                document.getElementById('reminderBanner').style.display = 'none';
            }
        }

        // Export data to JSON
        function exportData() {
            const data = {
                habits: habits,
                activeHabitId: activeHabitId,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `habit-tracker-export-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Import data from JSON file
        function importData() {
            document.getElementById('importFile').click();
        }

        // Handle file import
        function handleFileImport(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    if (importedData.habits && Array.isArray(importedData.habits)) {
                        habits = importedData.habits;
                        
                        if (importedData.activeHabitId) {
                            activeHabitId = importedData.activeHabitId;
                        } else if (habits.length > 0) {
                            activeHabitId = habits[0].id;
                        }
                        
                        // Update UI and save
                        renderHabitsList();
                        generateCalendar(currentMonth, currentYear);
                        updateStreakDisplay();
                        saveToLocalStorage();
                        
                        alert('Data imported successfully!');
                    } else {
                        alert('Invalid data format. Could not import.');
                    }
                } catch (error) {
                    alert('Error importing data: ' + error.message);
                }
            };
            
            reader.readAsText(file);
            
            // Reset file input
            e.target.value = '';
        }

        // Set up event listeners
        function setupEventListeners() {
            // Calendar navigation
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                generateCalendar(currentMonth, currentYear);
            });
            
            document.getElementById('nextMonth').addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                generateCalendar(currentMonth, currentYear);
            });
            
            document.getElementById('todayMonth').addEventListener('click', () => {
                const today = new Date();
                currentMonth = today.getMonth();
                currentYear = today.getFullYear();
                generateCalendar(currentMonth, currentYear);
            });
            
            // Add habit form
            document.getElementById('addHabitForm').addEventListener('submit', (e) => {
                e.preventDefault();
                addNewHabit();
            });
            
            // Modal buttons
            document.getElementById('closeModal').addEventListener('click', closeDayModal);
            document.getElementById('cancelModal').addEventListener('click', closeDayModal);
            document.getElementById('saveModal').addEventListener('click', saveDayEntry);
            
            // Reminder toggle
            document.getElementById('reminderToggle').addEventListener('change', () => {
                checkReminder();
                saveToLocalStorage();
            });
            
            // Dismiss reminder
            document.getElementById('dismissReminder').addEventListener('click', () => {
                document.getElementById('reminderBanner').style.display = 'none';
            });
            
            // Export/import buttons
            document.getElementById('exportData').addEventListener('click', exportData);
            document.getElementById('importData').addEventListener('click', importData);
            document.getElementById('importFile').addEventListener('change', handleFileImport);
            
            // Close modal when clicking outside
            document.getElementById('dayModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('dayModal')) {
                    closeDayModal();
                }
            });
        }
    </script>
</body>
</html>